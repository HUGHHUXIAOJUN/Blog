---
layout:     post
title:      回流与重绘
subtitle:   reflow&repaint
date:       2018-6-4 
author:     Chaser
header-img: 
catalog: true
tags:
    - html/css
---

### 浏览器渲染页面  

浏览器通过请求获得服务器返回的html文档后，会解析生成DOM Tree，然后会根据CSS代码解析生成CSS Rule Tree或者称为CSSOM Tree。二者结合后生成Render Tree（渲染树），浏览器知道了所有节点以及其对应的样式，就会计算它们在浏览器中的大小和位置，然后呈现出来。

- css必须完全解析完毕才能进入生成渲染树环节
- js的执行会阻塞html文档的解析

### 回流
当Render Tree中的一部分(或全部)因为元素的规模尺寸，布局，隐藏等改变而需要重新构建。这就称为**回流(reflow)**。

### 重绘
当Render Tree中的一些元素需要更新属性，而这些属性只是影响元素的外观，风格，而不会影响布局的，比如`background-color`。则就叫称为**重绘(repaint)**。
- 每个页面至少需要一次回流，就是在页面第一次加载的时候。
- 在回流的时候，浏览器会使渲染树中受到影响的部分失效，并重新构造这部分渲染树，完成回流后，浏览器会重新绘制受影响的部分到屏幕中，该过程成为重绘。
- 回流必将引起重绘，而重绘不一定会引起回流。


### 回流发生情景
- 添加或者删除可见的DOM元素
- 元素位置改变
- 元素尺寸改变——边距、填充、边框、宽度和高度
- 内容改变——比如文本改变或者图片大小改变而引起的计算值宽度和高度改变
- 页面渲染初始化
- 浏览器窗口尺寸改变——resize事件发生时

### 浏览器对其的优化
因为回流的开销很大，而如果每次进行DOM操作都要进行回流+重绘的话，浏览器会受不了。此时浏览器通常会**维护一个队列**，把所有会引起回流、重绘的操作放入这个队列，**等队列中的操作到了一定的数量或者到了一定的时间间隔**，浏览器就会flush队列，进行**一个批处理**。这样就会让多次的回流、重绘变成一次回流重绘。
